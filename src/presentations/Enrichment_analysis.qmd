---
title: "Enrichment analysis"
format:
  revealjs: 
    slide-number: true
    chalkboard: 
      buttons: false
    preview-links: auto
    css: styles.css
---

## Motivation

::: columns
::: {.column width="45%"}

::: incremental

- What to do with your list of DE genes?
- Interpretation can be difficult with many DE genes
- Are our DE genes enriched for a biological function, pathway, TF regulation?
:::
:::

::: {.column width="55%"}
![](img/volcano.png)
:::
:::

## Mapping genes to gene sets with specific biology

. . . 

Regrouping genes together in meaningful sets

::: incremental
- Same pathway
- Same location in the cell
- Same molecular function
:::

## The universe matters

. . .

Numerous gene set collections available

::: incremental
- Gene Ontologies
- Reactome
- KEGG
- MSigDB
- Custom gene sets (literature, tentative annotation)
- many more ...
:::

## The universe matters 

MsigDB: [https://www.gsea-msigdb.org/gsea/msigdb/index.jsp](https://www.gsea-msigdb.org/gsea/msigdb/index.jsp)

![](img/MSigDB.png)


## Computing Enrichment

![](img/enrichmentAnalysis_methods.jpg)

::: footer
Zhao, K., Rhee Y.R. Trends in Genetics (2023)
:::

## Overrepresentation analysis

Basically a Fisher's exact test with p-value correction

::: {.columns}

::: {.column width="60%"}
|  | DE | Not DE |
|---|---|---|
| in gene set | A | B |
| not in gene set | C | D |

![](img/ORA.png){.absolute top="400" left="30" width="340" height="300"}
:::

::: {.column width="40%"}
N = A + B + C + D

M = A + B

n = A + C

k = A

$$
p = 1- \sum_{i=0}^{k-1} 
\frac{
\binom{M}{i}
\binom{N-M}{n-i}
}{
\binom{N}{n}
}
$$

:::

:::

## Gene Set Enrichment Analysis (GSEA)

::: incremental

- Based on a ranking along a continous measure (e.g. logFC)
- No cutoff for DE versus not DE needed
- Permutation scheme to test for significance

:::

![](img/GSEA.png){.absolute top="370" left="30" width="400" height="350"}

. . .

![](img/GSEA2.webp){.absolute top="370" left="500" width="400" height="350"}

## clusterProfiler

::: incremental
- [ClusterProfiler](https://bioconductor.org/packages/release/bioc/html/clusterProfiler.html): user-friendly R package for enrichment analysis
- Multiple enrichment detection algorithms, several databases and visulaizations implemented
- For more details check out their [vignette](https://yulab-smu.top/biomedical-knowledge-mining-book/index.html)
:::

## clusterProfiler

::: {.columns}

::: {.column width="50%"}

```r
ego <- enrichGO(
  gene          = gene_list,
  OrgDb         = org.Mm.eg.db,
  keyType       = "ENTREZID",
  ont           = "BP",
  pAdjustMethod = "BH",
  qvalueCutoff  = 0.05
)
```

:::

::: {.column width="50%"}

```r
gse <- gseGO(
  geneList      = gene_list, 
  ont           = "ALL", 
  keyType       = "ENSEMBL", 
  nPerm         = 10000, 
  minGSSize     = 3, 
  maxGSSize     = 800, 
  pvalueCutoff  = 0.05, 
  OrgDb         = org.Mm.eg.db, 
  pAdjustMethod = "none"
)
```

:::
:::

